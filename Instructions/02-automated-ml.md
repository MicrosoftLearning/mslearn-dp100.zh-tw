---
lab:
  title: 使用自動化機器學習
ms.openlocfilehash: 9836a169752705779f263e7b005baf11e2f7b616
ms.sourcegitcommit: 8601551af6c32a4c75fd9ecffce750583c2ab4b8
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/01/2022
ms.locfileid: "145195755"
---
# <a name="use-automated-machine-learning"></a>使用自動化機器學習

Azure Machine Learning 包含「自動化機器學習」功能，可利用雲端計算的可擴縮性，自動同時嘗試多個前置處理技術與模型定型演算法，以尋找針對您的資料執行效能最佳的受監督機器學習模型。

在此練習中，您將會在 Azure Machine Learning 工作室內使用適用於自動化機器學習的視覺化介面

> **注意**：您也可以藉由使用 Azure Machine Learning SDK 來執行自動化機器學習。

## <a name="before-you-start"></a>在您開始使用 Intune 之前

若您尚未這樣做，請先完成 *[建立 Azure Machine Learning 工作區](01-create-a-workspace.md)* 練習，以建立 Azure Machine Learning 工作區與計算執行個體，並複製本練習所需的筆記本。

## <a name="configure-compute-resources"></a>設定計算資源

若要使用自動化機器學習，您需要一個能夠執行模型定型實驗的計算。

1. 使用與 Azure 訂閱相關聯的 Microsoft 認證登入 [Azure Machine Learning 工作室](https://ml.azure.com?azure-portal=true)，然後選取您的 Azure Machine Learning 工作區。
2. 在 Azure Machine Learning 工作室中，檢視工作區的 [計算] 頁面，如果計算執行個體尚未執行，請在 [計算執行個體] 索引標籤中啟動計算執行個體。 您將使用此計算執行個體來測試已定型的模型。
3. 在執行個體時正在啟動時，切換至 [計算叢集] 索引標籤，然後使用下列設定新增計算叢集。 您將在此叢集上執行自動化機器學習實驗，以利用其能夠將定型回合分散到多個計算節點的能力：
    - **位置**：*與您的工作區服務位置相同*
    - **虚拟机层**：专用
    - **虛擬機器類型**：CPU
    - **虛擬機器大小**：Standard_DS11_v2
    - **計算名稱**：輸入唯一的名稱
    - **節點數目下限**：0
    - **節點數目上限**：2
    - **縮小前的閒置秒數**：120
    - **啟用 SSH 存取**：未選取

## <a name="create-a-dataset"></a>建立資料集

現在您有了一些可用來處理資料的計算資源，便需要一種方式來儲存和內嵌要處理的資料。

1. 在網頁瀏覽器中查看逗點分隔的資料 https://aka.ms/diabetes-data。 然後將之儲存為名為 **diabetes.csv** 的本機檔案 (您將檔案儲存在哪裡並不重要)。
2. 在 Azure Machine Learning 工作室中，檢視 [資料集] 頁面。 資料集代表您計劃在 Azure ML 中使用的特定資料檔案或資料表。
3. 使用下列設定，從本地檔案建立新的資料集：
    * **基本資訊**：
        * **名稱**：糖尿病資料集
        * **資料集類型**：表格式
        * **描述**：糖尿病資料
    * **資料** 存放區和檔案選取：
        * **選取或建立資料** 存放區：目前選取的資料存放區
        * **為您的資料集選取檔案**：瀏覽至剛才下載的 **diabetes.csv** 檔案。
        * **上傳路徑**：*保留預設選項*
        * **略過資料驗證**：未選取
    * **設定和預覽**：
        * **檔案格式**：分隔
        * **分隔符號**：逗號
        * **編碼**：UTF-8
        * **資料行標題**：只有第一個檔案有標題
        * **跳過資料列**：無
    * **結構描述**：
        * 包含 [路徑] 以外的所有資料行
        * 檢閱自動偵測到的類型
    * **確認詳細資料**：
        * 請不要在建立後分析資料集
4. 建立資料集之後，請將其開啟，並檢視 [探索] 頁面，以查看資料的範例。 此資料呈現了已測試糖尿病病患的詳細資料，而您將使用它來定型模型，藉此根據臨床測量來預測病患測試是否得到糖尿病的能性。

    > **注意**：您可以選擇性地產生資料集的 *設定檔*，以查看更多統計詳細資料。

## <a name="run-an-automated-machine-learning-experiment"></a>執行自動化機器學習實驗

在 Azure Machine Learning 中，您所執行的作業稱為「實驗」。 請依照下列步驟執行實驗，此實驗會使用自動化機器學習，定型出能夠預測糖尿病診斷結果的分類模型。

1. 在 Azure Machine Learning 工作室中，檢視 [自動化 ML] 頁面 (位在 [作者] 下)。
2. 使用下列設定，建立新的自動化 ML 回合：
    - **選取資料集**：
        - **資料集**：糖尿病資料集
    - **設定回合**：
        - **新的實驗名稱**：mslearn-automl-diabetes
        - **目標資料行**：有糖尿病 (*這是模型將定型以預測的標籤)*
        - **選取計算類型**：計算叢集
        - **選取 Azure ML 計算叢集**：*您先前建立的計算叢集*
    - **工作類型和設定**：
        - **工作類型**：分類
        - 選取 [檢視額外組態設定] 以開啟 [其他組態]：
            - **主要計量**：選取 [AUC_Weighted] *(我們之後會再詳加解釋這個計量！)*
            - **解釋最佳模型**：已選取 - 此選項會導致自動化機器學習計算最佳模型的特徵重要度；讓您能夠判斷每個特徵對已預測標籤的影響。
            - **使用所有支援的模型**：<u>取消</u>選取 - 我們將限制實驗只嘗試幾個特定演算法。
            - **已允許的模型**：僅選取 [LogisticRegression] 和 [RandomForest]。 這些是實驗中唯一會嘗試使用的演算法。
            - **結束準則**：
                - **定型作業時間 (小時)**：0.5 - *這會導致實驗在最長 30 分鐘後結束。*
                - **計量分數閾值**：0.90 - *這會導致當模型的加權 AUC 計量達到 90% 以上時終止實驗。*
        - 選取 [檢視特徵化設定] 以開啟 [特徵化]：
            - **啟用特徵化**：已選取 - 這會導致 Azure Machine Learning 在定型之前自動預先處理特徵。
    - **選取驗證和測試類型**：
        - **驗證類型**：訓練/驗證分割
        - **資料的百分比驗證**：30
        - **測試資料集**：不需要任何測試資料集

3. 當您完成提交自動化 ML 回合詳細資料時，將會自動啟動。 您可以在 [屬性] 窗格中觀察執行的狀態。
4. 當執行狀態變更為 [正在執行] 時，檢視 [模型] 索引標籤，並觀察是否會嘗試定型演算法和預先處理步驟的每個可能組合，並評估產生之模型的效能。 此頁面將會定期自動重新整理，但您也可以選取 [&#8635; 重新整理]。 可能需要 10 分鐘左右的時間才會開始顯示模型，因為叢集節點必須先初始化，且要在資料特徵化流程完成後才能開始定型。 現在可能是喝咖啡休息的好時機！
5. 等待實驗完成。

## <a name="review-the-best-model"></a>檢閱最佳模型

實驗完成後，您可以檢閱所產生執行效能最佳的模型 (請注意，在此案例中，我們使用允出準則停止實驗，因此，實驗所找到的「最佳」模型可能不是最佳的模型，而只是在此練習允許的時間與計量限制內找到的最佳模型！)。

1. 在自動化機器學習執行的 [詳細資料] 索引標籤上，記下最佳模型摘要。
2. 選取最佳模型的 [演算法名稱]，以檢視產生的子執行。

    最佳模型是以您指定的評估計量 (*AUC_Weighted*) 為基礎識別的結果。 為計算此計量，定型程序會使用部分資料將模型定型，並應用稱為「交叉驗證」的技術，使用未定型的資料反覆地測試已定型的模型，並將預測的值與實際的已知值進行比較。 從這些比較中，會表格式列出由確判為真、誤判為真、確判為否和誤判為否所組成的 *混淆矩陣*，並計算出額外的分類計量，其中包括比較確判為真與誤判為真比率的接收運算子曲線 (ROC) 圖表。 此曲線下的區域 (AUC) 是經常用來評估分類表現的計量。
3. 在 [AUC_Weighted] 值的旁邊，選取 [檢視所有其他計量] 以查看分類模型其他可能評估計量的值。
4. 選取 [計量] 索引標籤，並檢閱您可以檢視模型的效能計量。 當中包括了 **confusion_matrix** 視覺效果，在其中會顯示已驗證模型的混淆矩陣，以及包含了 ROC 圖表的 **accuracy_table** 視覺效果。
5. 選取 [解釋] 索引標籤，選取 [解釋識別碼]，然後選取 [彙總重要度] 頁面。 這會顯示資料集內的每個特徵影響標籤預測的程度。

## <a name="deploy-a-predictive-service"></a>部署預測性服務

使用自動化機器學習將一些模型定型之後，您可以將執行效能最佳的模型部署為服務，以供用戶端應用程式使用。

> **注意**：在 Azure Machine Learning 中，您可以將服務部署為 Azure 容器執行個體 (ACI) 或 Azure Kubernetes Service (AKS) 叢集。 針對實際執行案例，建議使用 AKS 部署，您必須在為其建立 *推斷叢集* 計算目標。 在此練習中，您將使用 ACI 服務，這是適合用來測試的部署目標，而且不需要建立推斷叢集。

1. 針對產出最佳模型的執行回合，選取 [詳細資料] 索引標籤。
2. 從 [部署] 選項中，使用 [部署至 Web 服務] 按鈕來部署具有下列設定的模型：
    - **名稱**：auto-predict-diabetes
    - **描述**：預測糖尿病
    - **計算類型**：Azure 容器執行個體
    - **啟用驗證**：已選取
    - **使用自訂部署資產**：未選取
3. 等待部署啟動，這可能需要幾秒鐘的時間。 接著，在 [模型摘要] 區段中的 [模型] 索引標籤上，觀察 **auto-predict-diabetes** 服務的 [部署狀態]，此狀態應該是 [正在執行]。 等待此狀態變更為 [成功]。 您可能需要定期選取 [&#8635; 重新整理]。  **注意** 這可能需要一段時間 - 請耐心等候！
4. 在 Azure Machine Learning 工作室中，檢視 [端點] 頁面，然後選取 **auto-predict-diabetes** 即時端點。 接著，選取 [取用] 索引標籤，並記下下列資訊。 您需要此資訊，才能從用戶端應用程式連線至您已部署的服務。
    - 服務的 REST 端點
    - 服務的主要金鑰
5. 請注意，您可以使用這些值旁邊的 &#10697; 連結，將其複製到剪貼簿。

## <a name="test-the-deployed-service"></a>測試已部署的服務

既然您已經部署服務，您可以使用一些簡單的程式碼進行測試。

1. 在瀏覽器中開啟 **auto-predict-diabetes** 服務頁面的 [取用] 頁面之後，就會開啟新的瀏覽器索引標籤，並開啟 Azure Machine Learning 工作室的另一個執行個體。 然後您就可以在新的索引標籤中，檢視 [筆記本] 頁面。
2. 在 [筆記本] 頁面的 [我的檔案] 下，流覽至您複製筆記本存放庫的 **/users/*您的使用者名稱*/mslearn-dp100** 資料夾，然後開啟 [取得 AutoML 預測] 筆記本。
3. 開啟了筆記本之後，請務必在 [計算] 方塊中選取先前建立的計算執行個體，且其狀態為 [執行中]。
4. 在筆記本中，將 **ENDPOINT** 和 **PRIMARY_KEY** 預留位置取代為您服務的值，您可以從端點頁面上的 [取用] 索引標籤上複製。
5. 執行程式碼儲存格，並檢視 Web 服務所傳回的輸出。

## <a name="clean-up"></a>清除

您建立的 Web 服務會裝載在 *Azure 容器執行個體* 中。 如果不打算進一步試驗此服務，則應刪除端點，以避免產生不必要的 Azure 使用量。 您也應該停止計算執行個體，直到再次需要為止。

1. 在 Azure Machine Learning 工作室的 [端點] 索引標籤上，選取 **auto-predict-diabetes** 端點。 然後選取 [刪除] (&#128465;)，並確認您想要刪除此端點。
2. 在 [計算] 頁面的 [計算執行個體] 索引標籤中，選取計算執行個體，然後選取 [停止]。

> **注意**：停止您的計算可確保您的訂用帳戶不需支付計算資源的費用。 不過，只要您的訂用帳戶中有 Azure Machine Learning 工作區，您就必須為了資料儲存空間支付少量的費用。 如果您已完成探索 Azure Machine Learning，則可刪除包含 Azure Machine Learning 工作區及其相關的資源群組。 不過，如果您打算完成此系列的任何其他實驗室，則必須重複 *[建立 Azure Machine Learning 工作區](01-create-a-workspace.md)* 練習，以先建立工作區並準備好環境。
